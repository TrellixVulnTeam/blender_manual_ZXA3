<document source="/home/htran/blender_documentations/blender_docs/manual/advanced/app_templates.rst">
 <target refid="bpy-ops-wm-app-template">
 </target>
 <target refid="app-templates">
 </target>
 <section ids="application-templates app-templates bpy-ops-wm-app-template" names="application\ templates app_templates bpy.ops.wm.app_template">
  <title>
   Application Templates
  </title>
  <section ids="usage" names="usage">
   <title>
    Usage
   </title>
   <paragraph>
    Application templates are a feature that allows you to define a re-usable configuration
that can be selected to replace the default configuration,
without requiring a separate Blender installation or overwriting your personal settings.
   </paragraph>
   <paragraph>
    Application templates can be selected from the splash screen or
    <inline classes="menuselection" rawtext=":menuselection:`File --&gt; New`">
     File ‣ New
    </inline>
    sub-menu.
   </paragraph>
   <paragraph>
    When there are no templates found the menu will not be displayed on the splash screen.
   </paragraph>
   <paragraph>
    New application templates can be installed from the
    <reference internal="True" refuri="#topbar-app-menu">
     <inline classes="std std-ref">
      App Menu
     </inline>
    </reference>
    .
   </paragraph>
   <paragraph>
    If you would like to keep the current application template active on restarting Blender, save your preferences.
   </paragraph>
   <section ids="motivation" names="motivation">
    <title>
     Motivation
    </title>
    <paragraph>
     In some cases it’s not enough to write a single script or add-on,
and expect someone to replace their preferences and startup file, install scripts and change their keymap.
    </paragraph>
    <paragraph>
     The goal of application templates is to support switching to a customized configuration
without disrupting your existing settings and installation.
    </paragraph>
    <paragraph>
     This means people can build their own
     <emphasis>
      applications
     </emphasis>
     on top of Blender that can be easily distributed.
    </paragraph>
   </section>
   <section ids="details" names="details">
    <title>
     Details
    </title>
    <paragraph>
     An application template may define its own:
    </paragraph>
    <definition_list>
     <definition_list_item>
      <term>
       Startup File
      </term>
      <definition>
       <paragraph>
        The default file to load with this template.
       </paragraph>
      </definition>
     </definition_list_item>
     <definition_list_item>
      <term>
       Preferences
      </term>
      <definition>
       <paragraph>
        Only certain preferences from a template are used:
       </paragraph>
       <bullet_list bullet="-">
        <list_item>
         <paragraph>
          Themes.
         </paragraph>
        </list_item>
        <list_item>
         <paragraph>
          Add-ons.
         </paragraph>
        </list_item>
        <list_item>
         <paragraph>
          Keymaps.
         </paragraph>
        </list_item>
        <list_item>
         <paragraph>
          Viewport lighting.
         </paragraph>
        </list_item>
       </bullet_list>
      </definition>
     </definition_list_item>
     <definition_list_item>
      <term>
       Splash Screen
      </term>
      <definition>
       <paragraph>
        Templates may provide their own splash screen image.
       </paragraph>
      </definition>
     </definition_list_item>
     <definition_list_item>
      <term>
       Python Scripts
      </term>
      <definition>
       <paragraph>
        While templates have access to the same functionality as any other scripts,
typical operations include:
       </paragraph>
       <bullet_list bullet="-">
        <list_item>
         <paragraph>
          Modifying and replacing parts of the user interface.
         </paragraph>
        </list_item>
        <list_item>
         <paragraph>
          Defining new menus, keymaps and tools.
         </paragraph>
        </list_item>
        <list_item>
         <paragraph>
          Defining a custom add-on path for template specific add-ons.
         </paragraph>
        </list_item>
       </bullet_list>
      </definition>
     </definition_list_item>
    </definition_list>
    <paragraph>
     Templates also have their own user configuration, so saving a startup file while using a template
won’t overwrite your default startup file.
    </paragraph>
   </section>
   <section ids="directory-layout" names="directory\ layout">
    <title>
     Directory Layout
    </title>
    <paragraph>
     Templates may be located in one of two locations within the
     <literal>
      scripts
     </literal>
     directory.
    </paragraph>
    <definition_list>
     <definition_list_item>
      <term>
       Template locations:
      </term>
      <definition>
       <line_block>
        <line>
         <literal>
          {BLENDER_USER_SCRIPTS}/startup/bl_app_templates_user
         </literal>
        </line>
        <line>
         <literal>
          {BLENDER_SYSTEM_SCRIPTS}/startup/bl_app_templates_system
         </literal>
        </line>
       </line_block>
      </definition>
     </definition_list_item>
    </definition_list>
    <paragraph>
     User configuration is stored in a subdirectory:
    </paragraph>
    <definition_list>
     <definition_list_item>
      <term>
       Without a template:
      </term>
      <definition>
       <line_block>
        <line>
         <literal>
          ./config/startup.blend
         </literal>
        </line>
        <line>
         <literal>
          ./config/userpref.blend
         </literal>
        </line>
       </line_block>
      </definition>
     </definition_list_item>
     <definition_list_item>
      <term>
       With a template:
      </term>
      <definition>
       <line_block>
        <line>
         <literal>
          ./config/{APP_TEMPLATE_ID}/startup.blend
         </literal>
        </line>
        <line>
         <literal>
          ./config/{APP_TEMPLATE_ID}/userpref.blend
         </literal>
        </line>
       </line_block>
      </definition>
     </definition_list_item>
    </definition_list>
    <paragraph>
     See
     <reference internal="True" refuri="#blender-directory-layout">
      <inline classes="std std-ref">
       Blender’s Directory Layout
      </inline>
     </reference>
     for details on script and configuration locations.
    </paragraph>
   </section>
   <section ids="command-line-access" names="command\ line\ access">
    <title>
     Command Line Access
    </title>
    <paragraph>
     Using the
     <reference internal="True" refuri="#command-line-args">
      <inline classes="std std-ref">
       command-line arguments
      </inline>
     </reference>
     you can setup a launcher
that opens Blender with a specific app template:
    </paragraph>
    <literal_block force_highlighting="True" highlight_args="{}" language="sh" linenos="False" xml:space="preserve">
     blender --app-template my_template
    </literal_block>
   </section>
  </section>
  <section ids="template-contents" names="template\ contents">
   <title>
    Template Contents
   </title>
   <paragraph>
    Each of the following files can be used for application templates but are optional.
   </paragraph>
   <definition_list>
    <definition_list_item>
     <term>
      <literal>
       startup.blend
      </literal>
     </term>
     <definition>
      <paragraph>
       Factory startup file to use for this template.
      </paragraph>
     </definition>
    </definition_list_item>
    <definition_list_item>
     <term>
      <literal>
       userpref.blend
      </literal>
     </term>
     <definition>
      <paragraph>
       Factory preferences file to use for this template.
      </paragraph>
      <paragraph>
       When omitted preferences are shared with the default Blender configuration.
      </paragraph>
      <paragraph>
       <emphasis>
        (As noted previously, this is only used for a subset of preferences).
       </emphasis>
      </paragraph>
     </definition>
    </definition_list_item>
    <definition_list_item>
     <term>
      <literal>
       splash.png
      </literal>
      ,
      <literal>
       splash_2x.png
      </literal>
     </term>
     <definition>
      <paragraph>
       Splash screen to override Blender’s default artwork (not including header text).
      </paragraph>
      <paragraph>
       Must be
       <literal>
        501x250
       </literal>
       and
       <literal>
        1002x500
       </literal>
       (used for HiDPI monitors).
      </paragraph>
     </definition>
    </definition_list_item>
    <definition_list_item>
     <term>
      <literal>
       __init__.py
      </literal>
     </term>
     <definition>
      <paragraph>
       A Python script which must contain
       <literal>
        register
       </literal>
       and
       <literal>
        unregister
       </literal>
       functions.
      </paragraph>
     </definition>
    </definition_list_item>
   </definition_list>
   <note>
    <paragraph>
     Bundled blend-files
     <literal>
      startup.blend
     </literal>
     and
     <literal>
      userpref.blend
     </literal>
     are considered
     <emphasis>
      Factory Settings
     </emphasis>
     and are never overwritten.
    </paragraph>
    <paragraph>
     The user may save their own startup/preferences while using this template
which will be stored in their user-configuration.
    </paragraph>
    <paragraph>
     The original template settings can be loaded using:
     <emphasis>
      Load Template Factory Settings
     </emphasis>
     from the file menu in much the same way
     <emphasis>
      Load Factory Settings
     </emphasis>
     works.
    </paragraph>
   </note>
  </section>
  <section ids="template-scripts" names="template\ scripts">
   <title>
    Template Scripts
   </title>
   <paragraph>
    While app templates can use Python scripts,
they simply have access to the same API’s available for add-ons and any other scripts.
   </paragraph>
   <paragraph>
    As noted above, you may optionally have an
    <literal>
     __init__.py
    </literal>
    in your app template.
   </paragraph>
   <paragraph>
    This has the following advantages:
   </paragraph>
   <bullet_list bullet="-">
    <list_item>
     <paragraph>
      Changes can be made to the startup or preferences, without having to distribute a blend-file.
     </paragraph>
    </list_item>
    <list_item>
     <paragraph>
      Changes can be made dynamically.
     </paragraph>
     <paragraph>
      You could for example – configure the template to check the number of processors, operating system and memory,
then set values based on this.
     </paragraph>
    </list_item>
    <list_item>
     <paragraph>
      You may enable add-ons associated with your template.
     </paragraph>
    </list_item>
   </bullet_list>
   <paragraph>
    On activation a
    <literal>
     register
    </literal>
    function is called,
    <literal>
     unregister
    </literal>
    is called when another template is selected.
   </paragraph>
   <paragraph>
    As these only run once, any changes to defaults must be made via handler.
   </paragraph>
   <paragraph>
    Two handlers you’re likely to use are:
   </paragraph>
   <bullet_list bullet="-">
    <list_item>
     <paragraph>
      <literal>
       bpy.app.handlers.load_factory_preferences_post
      </literal>
     </paragraph>
    </list_item>
    <list_item>
     <paragraph>
      <literal>
       bpy.app.handlers.load_factory_startup_post
      </literal>
     </paragraph>
    </list_item>
   </bullet_list>
   <paragraph>
    These allow you to define your own “factory settings”, which the user may change,
just as Blender has it’s own defaults when first launched.
   </paragraph>
   <paragraph>
    This is an example
    <literal>
     __init__.py
    </literal>
    file which defines defaults for an app template to use.
   </paragraph>
   <literal_block force_highlighting="True" highlight_args="{}" language="python" linenos="False" xml:space="preserve">
    import bpy
from bpy.app.handlers import persistent

@persistent
def load_handler_for_preferences(_):
    print("Changing Preference Defaults!")
    from bpy import context

    prefs = context.preferences
    prefs.use_preferences_save = False

    kc = context.window_manager.keyconfigs["blender"]
    kc_prefs = kc.preferences
    if kc_prefs is not None:
        kc_prefs.select_mouse = 'RIGHT'
        kc_prefs.spacebar_action = 'SEARCH'
        kc_prefs.use_pie_click_drag = True

    view = prefs.view
    view.header_align = 'BOTTOM'


@persistent
def load_handler_for_startup(_):
    print("Changing Startup Defaults!")

    # Use smooth faces.
    for mesh in bpy.data.meshes:
        for poly in mesh.polygons:
            poly.use_smooth = True

    # Use material preview shading.
    for screen in bpy.data.screens:
        for area in screen.areas:
            for space in area.spaces:
                if space.type == 'VIEW_3D':
                    space.shading.type = 'MATERIAL'
                    space.shading.use_scene_lights = True



def register():
    print("Registering to Change Defaults")
    bpy.app.handlers.load_factory_preferences_post.append(load_handler_for_preferences)
    bpy.app.handlers.load_factory_startup_post.append(load_handler_for_startup)

def unregister():
    print("Unregistering to Change Defaults")
    bpy.app.handlers.load_factory_preferences_post.remove(load_handler_for_preferences)
    bpy.app.handlers.load_factory_startup_post.remove(load_handler_for_startup)
   </literal_block>
  </section>
 </section>
</document>